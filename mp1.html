import React, { useState } from 'react';

// Tokoshop Frontend — Single-file demo app
// - Uses Tailwind classes (assumes Tailwind is available in the host project)
// - Default export App component
// - Contains routes-style sections for: Store, POS, Articles, AHP SPK, Digital Invitations (30 templates gallery)
// - Minimal but production-minded structure for quick iteration

export default function App(){
  const [view, setView] = useState('home');
  const [cart, setCart] = useState([]);
  const [posItems, setPosItems] = useState([]);
  const [ahp, setAhp] = useState({criteria:[], alternatives:[]});

  // Sample product catalog
  const products = [
    {id:1, title:'Kartu Undangan Premium', price:25000, tag:'undangan'},
    {id:2, title:'Amplop Elegan', price:5000, tag:'aksesoris'},
    {id:3, title:'Paket Cetak 50', price:350000, tag:'paket'},
  ];

  // 30 invitation templates metadata
  const invitationTemplates = Array.from({length:30}).map((_,i)=>({
    id: i+1,
    name: `Template ${i+1}`,
    style: i%3===0? 'Minimal' : i%3===1? 'Floral' : 'Modern',
    description: `Desain ${i+1} — elegan & estetik untuk undangan pernikahan / acara resmi.`
  }));

  function addToCart(p){ setCart(c=>[...c,p]); }
  function removeFromCart(index){ setCart(c=>c.filter((_,i)=>i!==index)); }
  function addPosItem(item){ setPosItems(s=>[...s,item]); }

  return (
    <div className="min-h-screen bg-gray-50 text-gray-800">
      <header className="bg-white shadow p-4 flex items-center justify-between">
        <h1 className="text-xl font-semibold">Tokoshop Suite — Frontend Demo</h1>
        <nav className="space-x-3">
          {['home','shop','pos','articles','ahp','invites'].map(k=> (
            <button key={k} onClick={()=>setView(k)} className={`px-3 py-1 rounded ${view===k? 'bg-indigo-600 text-white': 'hover:bg-indigo-50'}`}>{k.toUpperCase()}</button>
          ))}
        </nav>
      </header>

      <main className="p-6">
        {view==='home' && (
          <section>
            <h2 className="text-2xl font-bold mb-3">Selamat datang</h2>
            <p className="mb-4">Pilih modul di atas: Toko, POS, Artikel, SPK AHP, atau Galeri Undangan (30 template).</p>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <Panel title="Toko Online" onClick={()=>setView('shop')}>
                Jual produk & template undangan.
              </Panel>
              <Panel title="POS" onClick={()=>setView('pos')}>Kasir cepat untuk offline & online.</Panel>
              <Panel title="Undangan" onClick={()=>setView('invites')}>30 template estetik.</Panel>
            </div>
          </section>
        )}

        {view==='shop' && (
          <section>
            <h2 className="text-2xl font-semibold mb-4">Toko Online</h2>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              {products.map(p=> (
                <div key={p.id} className="bg-white p-4 rounded shadow">
                  <div className="h-40 bg-gradient-to-br from-gray-100 to-white rounded mb-3 flex items-center justify-center">Thumbnail</div>
                  <h3 className="font-semibold">{p.title}</h3>
                  <p className="text-sm text-gray-500">{p.tag}</p>
                  <div className="flex items-center justify-between mt-3">
                    <div className="font-bold">Rp {format(p.price)}</div>
                    <button onClick={()=>addToCart(p)} className="px-3 py-1 rounded bg-green-600 text-white">Tambah</button>
                  </div>
                </div>
              ))}
            </div>

            <Cart cart={cart} remove={removeFromCart} />
          </section>
        )}

        {view==='pos' && (
          <section>
            <h2 className="text-2xl font-semibold mb-4">Aplikasi POS (Kasir)</h2>
            <div className="grid md:grid-cols-2 gap-4">
              <div className="bg-white p-4 rounded shadow">
                <h3 className="font-semibold mb-2">Input Produk Cepat</h3>
                <PosQuickAdd onAdd={(name,price)=>addPosItem({id:Date.now(),name,price})} />
                <div className="mt-4">
                  <h4 className="font-medium">Daftar Item (POS)</h4>
                  <ul className="mt-2 space-y-2">
                    {posItems.map(it=> (
                      <li key={it.id} className="flex justify-between bg-gray-50 p-2 rounded">{it.name} <span className="font-semibold">Rp {format(it.price)}</span></li>
                    ))}
                  </ul>
                </div>
              </div>
              <div className="bg-white p-4 rounded shadow">
                <h3 className="font-semibold">Transaksi Cepat</h3>
                <p className="text-sm text-gray-500">Tambahkan dari katalog atau input manual, lalu proses pembayaran.</p>
                <div className="mt-3">
                  <button onClick={()=>{ setPosItems([]); alert('Transaksi selesai (simulasi)'); }} className="px-3 py-2 bg-indigo-600 text-white rounded">Bayar</button>
                </div>
              </div>
            </div>
          </section>
        )}

        {view==='articles' && (
          <section>
            <h2 className="text-2xl font-semibold mb-4">Manajemen Artikel</h2>
            <ArticleEditor />
          </section>
        )}

        {view==='ahp' && (
          <section>
            <h2 className="text-2xl font-semibold mb-4">SPK — AHP (Analytic Hierarchy Process) — Simplified</h2>
            <AHPModule ahp={ahp} setAhp={setAhp} />
          </section>
        )}

        {view==='invites' && (
          <section>
            <h2 className="text-2xl font-semibold mb-4">Galeri Undangan — 30 Template</h2>
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
              {invitationTemplates.map(t=> (
                <div key={t.id} className="bg-white rounded shadow p-4">
                  <div className="h-36 mb-3 rounded overflow-hidden flex items-end" style={{background:`linear-gradient(180deg, rgba(0,0,0,0.05), rgba(255,255,255,0.02))`}}>
                    <div className="p-3">
                      <div className="text-sm font-semibold">{t.name}</div>
                      <div className="text-xs text-gray-500">{t.style} • {t.description}</div>
                    </div>
                  </div>
                  <div className="flex gap-2">
                    <button className="flex-1 px-3 py-2 rounded border" onClick={()=>alert('Preview: '+t.name)}>Preview</button>
                    <button className="flex-1 px-3 py-2 rounded bg-indigo-600 text-white" onClick={()=>alert('Pilih '+t.name)}>Pilih</button>
                  </div>
                </div>
              ))}
            </div>

            <div className="mt-6 bg-white p-4 rounded shadow">
              <h3 className="font-semibold mb-2">Fitur Undangan (ide tambahan)</h3>
              <ul className="list-disc ml-5 text-sm text-gray-600">
                <li>Custom text & photo upload</li>
                <li>RSVP & guest list export</li>
                <li>Counter hari menuju acara</li>
                <li>Integrasi pembayaran & cetak</li>
              </ul>
            </div>
          </section>
        )}

      </main>

      <footer className="p-4 text-center text-sm text-gray-500">Tokoshop Suite — Frontend Prototype</footer>
    </div>
  );
}

// -------------------- Helper components --------------------
function Panel({title, children, onClick}){
  return (
    <div className="bg-white p-4 rounded shadow cursor-pointer" onClick={onClick}>
      <h3 className="font-semibold">{title}</h3>
      <p className="text-sm text-gray-600">{children}</p>
    </div>
  );
}

function Cart({cart, remove}){
  const total = cart.reduce((s,i)=>s+i.price,0);
  return (
    <div className="mt-6 bg-white p-4 rounded shadow">
      <h3 className="font-semibold mb-2">Keranjang ({cart.length})</h3>
      {cart.length===0? <div className="text-sm text-gray-500">Kosong</div> : (
        <div>
          <ul className="space-y-2">
            {cart.map((c,i)=> (
              <li key={i} className="flex justify-between items-center">
                <div>{c.title}</div>
                <div className="flex items-center gap-2">
                  <div className="font-medium">Rp {format(c.price)}</div>
                  <button className="text-red-600 text-sm" onClick={()=>remove(i)}>Hapus</button>
                </div>
              </li>
            ))}
          </ul>
          <div className="mt-3 flex justify-between items-center">
            <div className="font-bold">Total: Rp {format(total)}</div>
            <button className="px-3 py-2 bg-green-600 text-white rounded">Checkout</button>
          </div>
        </div>
      )}
    </div>
  );
}

function PosQuickAdd({onAdd}){
  const [name,setName] = useState('');
  const [price,setPrice] = useState('');
  return (
    <div>
      <input value={name} onChange={e=>setName(e.target.value)} placeholder="Nama item" className="w-full p-2 border rounded mb-2" />
      <input value={price} onChange={e=>setPrice(e.target.value)} placeholder="Harga" className="w-full p-2 border rounded mb-2" />
      <button onClick={()=>{ if(!name||!price) return alert('Isi data'); onAdd(name, Number(price)); setName(''); setPrice(''); }} className="px-3 py-2 bg-indigo-600 text-white rounded">Tambah</button>
    </div>
  );
}

function ArticleEditor(){
  const [title,setTitle] = useState('');
  const [body,setBody] = useState('');
  const [saved, setSaved] = useState([]);
  function save(){ if(!title||!body) return alert('Masukkan judul & isi'); setSaved(s=>[{title,body,at:new Date().toISOString()}, ...s]); setTitle(''); setBody(''); }
  return (
    <div className="bg-white p-4 rounded shadow">
      <input value={title} onChange={e=>setTitle(e.target.value)} placeholder="Judul artikel" className="w-full p-2 border rounded mb-2" />
      <textarea value={body} onChange={e=>setBody(e.target.value)} rows={6} placeholder="Isi artikel (HTML allowed)" className="w-full p-2 border rounded mb-2" />
      <div className="flex gap-2">
        <button onClick={save} className="px-3 py-2 bg-indigo-600 text-white rounded">Simpan</button>
        <button onClick={()=>{ setTitle(''); setBody(''); }} className="px-3 py-2 border rounded">Bersihkan</button>
      </div>
      <div className="mt-4">
        <h4 className="font-semibold">Artikel Tersimpan</h4>
        <ul className="mt-2 space-y-2">
          {saved.map((s,i)=> (
            <li key={i} className="p-2 border rounded">
              <div className="font-semibold">{s.title}</div>
              <div className="text-xs text-gray-500">{new Date(s.at).toLocaleString()}</div>
              <div className="mt-2 text-sm" dangerouslySetInnerHTML={{__html: s.body}} />
            </li>
          ))}
        </ul>
      </div>
    </div>
  );
}

// -------------------- Simple AHP module --------------------
function AHPModule({ahp, setAhp}){
  const [criteriaText, setCriteriaText] = useState('Biaya,Kualitas,Waktu');
  const [altsText, setAltsText] = useState('Vendor A,Vendor B,Vendor C');

  function init(){
    const criteria = criteriaText.split(',').map(s=>s.trim()).filter(Boolean);
    const alternatives = altsText.split(',').map(s=>s.trim()).filter(Boolean);
    // Create simple pairwise matrices filled with 1 (equal) as starting point
    const criteriaMatrix = Array.from({length:criteria.length},()=>Array(criteria.length).fill(1));
    const altMatrices = alternatives.map(()=> Array.from({length:criteria.length},()=>Array(alternatives.length).fill(1)));
    setAhp({criteria,alternatives,criteriaMatrix,altMatrices});
  }

  function computeSimple(){
    // Very simplified scoring: equal weights from criteria matrix diagonal
    const {criteria=[],alternatives=[]} = ahp;
    if(!criteria.length || !alternatives.length) return alert('Inisialisasi terlebih dahulu');
    // Score each alternative with random-ish demo values (replace with real eigenvector calc in prod)
    const scores = alternatives.map((a,i)=> ({alt:a,score:Math.random()})).sort((a,b)=>b.score-a.score);
    alert('Hasil (simulasi):\n' + scores.map(s=>`${s.alt}: ${s.score.toFixed(3)}`).join('\n'));
  }

  return (
    <div className="bg-white p-4 rounded shadow">
      <label className="text-sm">Kriteria (pisah koma)</label>
      <input value={criteriaText} onChange={e=>setCriteriaText(e.target.value)} className="w-full p-2 border rounded mb-2" />
      <label className="text-sm">Alternatif (pisah koma)</label>
      <input value={altsText} onChange={e=>setAltsText(e.target.value)} className="w-full p-2 border rounded mb-2" />
      <div className="flex gap-2">
        <button onClick={init} className="px-3 py-2 bg-indigo-600 text-white rounded">Inisialisasi</button>
        <button onClick={computeSimple} className="px-3 py-2 border rounded">Hitung (simulasi)</button>
      </div>
      <div className="mt-4 text-sm text-gray-600">
        Modul AHP ini adalah starting point yang dapat dikembangkan: pairwise comparison input, eigenvalue/eigenvector solver, consistency ratio, dan UI visual untuk matriks.
      </div>
    </div>
  );
}

// -------------------- Utilities --------------------
function format(n){ return n.toLocaleString('id-ID'); }
